<!doctype html>
<html lang="en">

  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Convert CSV to JSON</title>
    <meta name="author" content="Josef Zacek">

    <style media="screen">
      .copy-to-clipboard-button {
        top: 50vh;
        right: 0;
        border-bottom-right-radius: 0;
        border-top-right-radius: 0;
      }
    </style>
  </head>

  <body>

    <div class="container my-5">
      <div class="row">
        <div class="col">

          <h1>Convert CSV to JSON</h1>

          <p>Simply select .csv file and get it converted to JSON</p>

          <div class="form-group">
            <label for="csv-file">Please select .csv file</label>
            <input type="file" id="csv-file" class="form-control-file" name="files" />
          </div>

          <div id="formated-json-data" class="border rounded p-3" contenteditable>
            <pre>
<code>
  <!-- injected code here -->
</code>
            </pre>
          </div>

        </div>
      </div>
    </div>

    <button type="button" class="btn btn-secondary position-fixed copy-to-clipboard-button d-none" data-clipboard-target="#formated-json-data" data-toggle="tooltip" data-placement="top" title="Copy to clipboard">
      COPY
    </button>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/papaparse@5.2.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js"></script>

    <script>
      var jsonData;

      // display formatted json
      function displayJsonData(jsonData) {
        var formatedJson = JSON.stringify(jsonData, undefined, 4);
        $("#formated-json-data pre code").empty().append(formatedJson);
      }

      // conver csv to json
      function handleFileSelect(evt) {
        var file = evt.target.files[0];

        Papa.parse(file, {
          header: true,
          dynamicTyping: true,
          complete: function(results) {
            jsonData = results;
            console.log(jsonData)
            displayJsonData(jsonData.data)
          }
        });
        $(".copy-to-clipboard-button").removeClass("d-none")
      }

          $(".copy-to-clipboard-button").removeClass("btn-secondary").addClass("btn-success").text("TEXT COPIED")

      // when user adds .cvs file
      $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();

        $("#csv-file").change(handleFileSelect);

        $("#csv-file").click(function() {
          $(".copy-to-clipboard-button").removeClass("btn-success").addClass("d-none btn-secondary").text("COPY")
        })

        $(".copy-to-clipboard-button").click(function() {
          CopyToClipboard("formated-json-data");
        })
      });

    </script>
  </body>

</html>
